# Xperion Wiki - ê°œë°œ ë¬¸ì„œ

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 ë°°ê²½ ë° ëª©í‘œ
D&D ê¸°ë°˜ í™ˆë¸Œë¥˜ TRPG ì„œë²„ë¥¼ ìœ„í•œ ì „ìš© ìœ„í‚¤ ì‹œìŠ¤í…œ ê°œë°œ. ê¸°ì¡´ êµ¬ê¸€ ì‹œíŠ¸ ê¸°ë°˜ ì„¤ì • ê´€ë¦¬ì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ê³ , ê¸€ì“°ê¸°ì— ìµœì í™”ëœ í”Œë«í¼ì„ ì œê³µí•œë‹¤.

### 1.2 í•µì‹¬ ê°€ì¹˜
- **ê¸€ì“°ê¸° ì¤‘ì‹¬**: ì„¸ê³„ê´€, ì„¤ì •, ìºë¦­í„° ë“±ì˜ ì„œì‚¬ì  ì½˜í…ì¸  ì‘ì„±ì— ìµœì í™”
- **êµ¬ì¡°í™”**: íƒœê·¸ ê¸°ë°˜ ë¶„ë¥˜ ì‹œìŠ¤í…œìœ¼ë¡œ ë³µì¡í•œ ì„¤ì •ì„ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬
- **í˜‘ì—…**: ì„œë²„ ë©¤ë²„ ëª¨ë‘ê°€ ììœ ë¡­ê²Œ í¸ì§‘ ê°€ëŠ¥
- **ì ‘ê·¼ì„±**: ë¹„ê°œë°œìë„ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì›¹ ê¸°ë°˜ ì¸í„°í˜ì´ìŠ¤

### 1.3 ì£¼ìš” ì‚¬ìš©ì
- Dungeon Master (DM): ì„¸ê³„ê´€ ì´ê´„ ê´€ë¦¬
- í”Œë ˆì´ì–´: ìºë¦­í„° ì„¤ì •, ìŠ¤í† ë¦¬ ê¸°ì—¬
- ì„œë²„ ë©¤ë²„: ì„¤ì • ì°¸ì¡° ë° í™•ì¥

---

## 2. ê¸°ìˆ  ìŠ¤íƒ ë° ì•„í‚¤í…ì²˜

### 2.1 ê¸°ìˆ  ìŠ¤íƒ

#### í”„ë¡ íŠ¸ì—”ë“œ
- **í”„ë ˆì„ì›Œí¬**: React 18
- **ë¹Œë“œ ë„êµ¬**: Vite
- **ë¼ìš°íŒ…**: React Router v6
- **ìŠ¤íƒ€ì¼ë§**: TailwindCSS (ë˜ëŠ” styled-components)
- **ë§ˆí¬ë‹¤ìš´**: react-markdown, remark/rehype í”ŒëŸ¬ê·¸ì¸
- **ìƒíƒœ ê´€ë¦¬**: React Context API (í•„ìš”ì‹œ Zustand)
- **HTTP í´ë¼ì´ì–¸íŠ¸**: Axios

#### ë°±ì—”ë“œ
- **ì–¸ì–´**: Python 3.11+
- **í”„ë ˆì„ì›Œí¬**: FastAPI
- **ORM**: SQLAlchemy 2.0
- **ë°ì´í„° ê²€ì¦**: Pydantic v2
- **ì¸ì¦**: JWT (python-jose)
- **GitHub ì—°ë™**: PyGithub
- **ë¡œê¹…**: structlog
- **ë¹„ë™ê¸°**: asyncio, httpx

#### ë°ì´í„°ë² ì´ìŠ¤
- **RDBMS**: PostgreSQL 15+
- **ë§ˆì´ê·¸ë ˆì´ì…˜**: Alembic
- **ìš©ë„**: ë©”íƒ€ë°ì´í„°, í†µê³„, ì‚¬ìš©ì ì„¸ì…˜, ê²€ìƒ‰ ì¸ë±ìŠ¤

#### ì¸í”„ë¼ ë° ë°°í¬
- **í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬**: Vercel
- **ë°±ì—”ë“œ ë°°í¬**: GCP Compute Engine e2-micro (Always Free)
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL 15 (VM ìì²´ ì„¤ì¹˜)
- **Markdown ì €ì¥ì†Œ**: GitHub Private Repository
- **ì´ë¯¸ì§€ ìŠ¤í† ë¦¬ì§€**: Cloudflare R2 (10GB ë¬´ë£Œ) ë˜ëŠ” GitHub Repository
- **ì›¹ ì„œë²„**: Nginx (ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ)
- **SSL ì¸ì¦ì„œ**: Let's Encrypt (ë¬´ë£Œ)
- **CI/CD**: GitHub Actions
- **ëª¨ë‹ˆí„°ë§**: Sentry (ì—ëŸ¬ íŠ¸ë˜í‚¹) + ìì²´ ë¡œê¹…

### 2.2 ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ì‚¬ìš©ì                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          í”„ë¡ íŠ¸ì—”ë“œ (React + Vite)                   â”‚
â”‚              Vercel/Netlify ë°°í¬                     â”‚
â”‚  - ìœ„í‚¤ ë·°ì–´ (ë§ˆí¬ë‹¤ìš´ ë Œë”ë§)                        â”‚
â”‚  - ì—ë””í„° UI                                         â”‚
â”‚  - ê²€ìƒ‰ ì¸í„°í˜ì´ìŠ¤                                    â”‚
â”‚  - íƒœê·¸ í•„í„°ë§                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ HTTPS (REST API)
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      GCP Compute Engine (e2-micro, Always Free)     â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Nginx (ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ + SSL)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FastAPI (Uvicorn)                          â”‚  â”‚
â”‚  â”‚  - /api/pages (CRUD)                        â”‚  â”‚
â”‚  â”‚  - /api/search                              â”‚  â”‚
â”‚  â”‚  - /api/tags                                â”‚  â”‚
â”‚  â”‚  - /api/upload (ì´ë¯¸ì§€)                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL 15 (ë¡œì»¬ ì„¤ì¹˜)                   â”‚  â”‚
â”‚  â”‚  - ê²€ìƒ‰ ì¸ë±ìŠ¤ (pg_trgm)                    â”‚  â”‚
â”‚  â”‚  - ë©”íƒ€ë°ì´í„° ìºì‹œ                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  GitHub Repository      â”‚
                â”‚   (Private)             â”‚
                â”‚                         â”‚
                â”‚  /content/              â”‚
                â”‚    â”œâ”€ characters/       â”‚
                â”‚    â”œâ”€ locations/        â”‚
                â”‚    â”œâ”€ items/            â”‚
                â”‚    â””â”€ lore/             â”‚
                â”‚  /images/               â”‚
                â”‚                         â”‚
                â”‚  âš ï¸ Source of Truth      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 ë°ì´í„° íë¦„

#### ë¬¸ì„œ ì¡°íšŒ
```
ì‚¬ìš©ì â†’ í”„ë¡ íŠ¸ì—”ë“œ â†’ ë°±ì—”ë“œ API â†’ PostgreSQL (content ìºì‹œ + ë©”íƒ€ë°ì´í„°)
       â† ë§ˆí¬ë‹¤ìš´ ì›ë³¸ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€» GitHub í˜¸ì¶œ ì—†ìŒ (ë¹ ë¥¸ ì‘ë‹µ, API rate limit ì ˆì•½)
```

#### ë¬¸ì„œ í¸ì§‘/ì‘ì„±
```
ì‚¬ìš©ì â†’ ì›¹ ì—ë””í„° â†’ ë°±ì—”ë“œ API â†’ 1. GitHub API (ì»¤ë°‹) - Source of Truth
                                â†’ 2. PostgreSQL (content + ë©”íƒ€ë°ì´í„° ìºì‹±)
                                â†’ 3. ê²€ìƒ‰ ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
                                â†’ 4. ë¡œê·¸ ê¸°ë¡
       â† ì„±ê³µ/ì‹¤íŒ¨ ì‘ë‹µ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â€» ë™ê¸°í™”: GitHub ì»¤ë°‹ ì„±ê³µ ì‹œ PostgreSQL ì¦‰ì‹œ ì—…ë°ì´íŠ¸
```

#### ê²€ìƒ‰
```
ì‚¬ìš©ì â†’ ê²€ìƒ‰ì–´ ì…ë ¥ â†’ ë°±ì—”ë“œ API â†’ PostgreSQL Trigram Search (content ëŒ€ìƒ)
       â† ê²€ìƒ‰ ê²°ê³¼ + snippet â†â”€â”€â”€â”€â”€â”€â”€â”˜

â€» PostgreSQLì— contentê°€ ìºì‹±ë˜ì–´ ìˆì–´ ë¹ ë¥¸ ê²€ìƒ‰ (<100ms)
â€» ì œëª©/ë³¸ë¬¸ ê°€ì¤‘ì¹˜ ê¸°ë°˜ relevance ìŠ¤ì½”ì–´ë§
```

---

## 3. ì£¼ìš” ê¸°ëŠ¥ ëª…ì„¸

### 3.1 í•„ìˆ˜ ê¸°ëŠ¥ (MVP)

#### 3.1.1 ë¬¸ì„œ ê´€ë¦¬
- **ë¬¸ì„œ ì¡°íšŒ**
  - ì¹´í…Œê³ ë¦¬ë³„ ëª©ë¡ (ìºë¦­í„°, ì§€ì—­, ì•„ì´í…œ, ë¡œì–´ ë“±)
  - ê°œë³„ ë¬¸ì„œ ìƒì„¸ í˜ì´ì§€
  - ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ (ì½”ë“œ í•˜ì´ë¼ì´íŒ…, í…Œì´ë¸”, ì²´í¬ë¦¬ìŠ¤íŠ¸ ì§€ì›)
  - ëª©ì°¨(TOC) ìë™ ìƒì„±

- **ë¬¸ì„œ ì‘ì„±/í¸ì§‘**
  - ì›¹ ê¸°ë°˜ ë§ˆí¬ë‹¤ìš´ ì—ë””í„°
  - ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°
  - Frontmatter í¸ì§‘ (ì œëª©, íƒœê·¸, ì‘ì„±ì, ë‚ ì§œ ë“±)
  - ìë™ ì €ì¥ (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€)

- **ë¬¸ì„œ ì‚­ì œ**
  - ì†Œí”„íŠ¸ ì‚­ì œ (GitHubì—ì„œ archived í´ë”ë¡œ ì´ë™)
  - ì‚­ì œ ë¡œê·¸ ê¸°ë¡

#### 3.1.2 íƒœê·¸ ì‹œìŠ¤í…œ
- **íƒœê·¸ ë¶„ë¥˜**
  - ê³„ì¸µì  íƒœê·¸ (ì˜ˆ: `ì¢…ì¡±/ì—˜í”„`, `ì§€ì—­/ë¶ë¶€/ì„¤ì‚°`)
  - ë‹¤ì¤‘ íƒœê·¸ ì§€ì›
  - íƒœê·¸ë³„ ë¬¸ì„œ ëª©ë¡

- **íƒœê·¸ í•„í„°ë§**
  - AND/OR ì¡°ê±´ ê²€ìƒ‰
  - íƒœê·¸ ì¡°í•© (ì˜ˆ: `ì¢…ì¡±:ë“œì›Œí”„ AND ì§€ì—­:ì‚°ë§¥`)

#### 3.1.3 ê²€ìƒ‰ ê¸°ëŠ¥
- **ì „ë¬¸ ê²€ìƒ‰ (Full-Text Search)**
  - ì œëª©, ë³¸ë¬¸ í†µí•© ê²€ìƒ‰
  - PostgreSQL `tsvector` í™œìš©
  - í•œê¸€ í˜•íƒœì†Œ ë¶„ì„ (í•„ìš”ì‹œ)

- **í•„í„° ì˜µì…˜**
  - ì¹´í…Œê³ ë¦¬ë³„ í•„í„°
  - ì‘ì„±ìë³„ í•„í„°
  - ë‚ ì§œ ë²”ìœ„ í•„í„°

#### 3.1.4 ì´ë¯¸ì§€/íŒŒì¼ ê´€ë¦¬
- **ì´ë¯¸ì§€ ì—…ë¡œë“œ**
  - ë“œë˜ê·¸ ì•¤ ë“œë¡­
  - ìë™ ë¦¬ì‚¬ì´ì§• (ìµœëŒ€ 2MB)
  - GitHub ì €ì¥ì†Œ ë˜ëŠ” Cloudflare R2

- **ì´ë¯¸ì§€ ì²¨ë¶€**
  - ë§ˆí¬ë‹¤ìš´ ì—ë””í„°ì—ì„œ ì´ë¯¸ì§€ ì‚½ì…
  - `![alt](url)` ìë™ ìƒì„±

### 3.2 ë¶€ê°€ ê¸°ëŠ¥ (Post-MVP)

#### 3.2.1 ë²„ì „ ê´€ë¦¬
- ë¬¸ì„œ íˆìŠ¤í† ë¦¬ (Git ì»¤ë°‹ ê¸°ë¡ í™œìš©)
- ë²„ì „ ë¹„êµ (diff)
- íŠ¹ì • ë²„ì „ìœ¼ë¡œ ë¡¤ë°±

#### 3.2.2 ë§í¬ ì‹œìŠ¤í…œ
- ìœ„í‚¤ ë§í¬ (`[[ë¬¸ì„œëª…]]` â†’ ìë™ ë§í¬ ìƒì„±)
- ì—­ë§í¬ (ì´ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ëŠ” ë‹¤ë¥¸ ë¬¸ì„œ)
- ë§í¬ ìœ íš¨ì„± ê²€ì‚¬

#### 3.2.3 í†µê³„ ë° ëª¨ë‹ˆí„°ë§
- ë¬¸ì„œë³„ ì¡°íšŒìˆ˜
- ì¸ê¸° ë¬¸ì„œ ë­í‚¹
- ìµœê·¼ ìˆ˜ì • ë¬¸ì„œ
- í¸ì§‘ í™œë™ ê·¸ë˜í”„

#### 3.2.4 ê³ ê¸‰ ê²€ìƒ‰
- ì •ê·œí‘œí˜„ì‹ ê²€ìƒ‰
- ìœ ì‚¬ ë¬¸ì„œ ì¶”ì²œ
- íƒœê·¸ ìë™ ì œì•ˆ

---

## 4. ë°ì´í„° êµ¬ì¡°

### 4.1 Markdown íŒŒì¼ êµ¬ì¡°

#### ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
content/
â”œâ”€â”€ characters/          # ìºë¦­í„°
â”‚   â”œâ”€â”€ player/         # í”Œë ˆì´ì–´ ìºë¦­í„°
â”‚   â””â”€â”€ npc/            # NPC
â”œâ”€â”€ locations/          # ì§€ì—­
â”‚   â”œâ”€â”€ cities/
â”‚   â”œâ”€â”€ dungeons/
â”‚   â””â”€â”€ wilderness/
â”œâ”€â”€ items/              # ì•„ì´í…œ
â”‚   â”œâ”€â”€ weapons/
â”‚   â”œâ”€â”€ armor/
â”‚   â””â”€â”€ artifacts/
â”œâ”€â”€ lore/               # ë¡œì–´/ì„¤ì •
â”‚   â”œâ”€â”€ history/
â”‚   â”œâ”€â”€ factions/
â”‚   â””â”€â”€ religions/
â””â”€â”€ sessions/           # ì„¸ì…˜ ê¸°ë¡
```

#### Frontmatter í˜•ì‹
```yaml
---
title: "ì—˜ë¡  ì‹¤ë²„ìŠ¤íŠ¸ë¼ì´ë“œ"
category: "characters/player"
tags:
  - "ì¢…ì¡±/ì—˜í”„"
  - "í´ë˜ìŠ¤/íŒ”ë¼ë”˜"
  - "íŒŒí‹°/ì‹¤ë²„ë¬¸"
author: "PlayerName"
created: "2024-01-15"
updated: "2024-01-20"
status: "active"  # active, archived, draft
summary: "ì •ì˜ë¥¼ ìˆ˜í˜¸í•˜ëŠ” ì—˜í”„ íŒ”ë¼ë”˜"
---

# ì—˜ë¡  ì‹¤ë²„ìŠ¤íŠ¸ë¼ì´ë“œ

## ê¸°ë³¸ ì •ë³´
- **ì¢…ì¡±**: í•˜ì´ì—˜í”„
- **í´ë˜ìŠ¤**: íŒ”ë¼ë”˜ (Oath of Devotion)
- **ë ˆë²¨**: 5

## ë°°ê²½ ìŠ¤í† ë¦¬
...
```

### 4.2 ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

#### 4.2.1 pages (ë¬¸ì„œ ë©”íƒ€ë°ì´í„° ë° ìºì‹œ)
```sql
-- pg_trgm extension í™œì„±í™” (Trigram ê²€ìƒ‰ìš©)
CREATE EXTENSION IF NOT EXISTS pg_trgm;

CREATE TABLE pages (
    id SERIAL PRIMARY KEY,
    slug VARCHAR(255) UNIQUE NOT NULL,  -- íŒŒì¼ ê²½ë¡œ (characters/player/elon.md)
    title VARCHAR(500) NOT NULL,
    category VARCHAR(100),
    author VARCHAR(100),

    -- ğŸ“„ ì»¨í…ì¸  ìºì‹± (GitHubì˜ ë§ˆí¬ë‹¤ìš´ ì›ë³¸ì„ PostgreSQLì— ìºì‹œ)
    content TEXT NOT NULL,  -- ë§ˆí¬ë‹¤ìš´ ì›ë³¸ (ê²€ìƒ‰ ë° ë¹ ë¥¸ ì‘ë‹µìš©)
    content_html TEXT,      -- ì„ íƒì‚¬í•­: ì‚¬ì „ ë Œë”ë§ëœ HTML (ì„±ëŠ¥ ìµœì í™”)

    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP NOT NULL,
    status VARCHAR(20) DEFAULT 'active',  -- active, archived, draft
    summary TEXT,

    -- ğŸ”„ GitHub ë™ê¸°í™” ë©”íƒ€ë°ì´í„°
    github_sha VARCHAR(40),   -- GitHub íŒŒì¼ SHA (ë³€ê²½ ê°ì§€, ì¤‘ë³µ ì—…ë°ì´íŠ¸ ë°©ì§€)
    github_url TEXT,          -- GitHub íŒŒì¼ URL (ì›ë³¸ ì†ŒìŠ¤ ì°¸ì¡°)
    last_synced_at TIMESTAMP, -- ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œê°„

    view_count INTEGER DEFAULT 0,
    CONSTRAINT status_check CHECK (status IN ('active', 'archived', 'draft'))
);

-- ê¸°ë³¸ ì¸ë±ìŠ¤
CREATE INDEX idx_pages_slug ON pages(slug);
CREATE INDEX idx_pages_category ON pages(category);
CREATE INDEX idx_pages_status ON pages(status);
CREATE INDEX idx_pages_updated ON pages(updated_at DESC);

-- ğŸ” ê²€ìƒ‰ìš© Trigram ì¸ë±ìŠ¤ (í•œê¸€ ê²€ìƒ‰ì— íš¨ê³¼ì )
CREATE INDEX idx_pages_title_trgm ON pages USING gin (title gin_trgm_ops);
CREATE INDEX idx_pages_content_trgm ON pages USING gin (content gin_trgm_ops);

-- ì„ íƒì‚¬í•­: Full-Text Search (tsvector) - Trigramë³´ë‹¤ ë¹ ë¥´ì§€ë§Œ í•œê¸€ ì§€ì› ì•½í•¨
-- CREATE INDEX idx_search_vector ON pages USING GIN(search_vector);
```

#### 4.2.2 tags (íƒœê·¸)
```sql
CREATE TABLE tags (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,  -- ì¢…ì¡±/ì—˜í”„
    display_name VARCHAR(100),  -- í‘œì‹œìš© ì´ë¦„
    description TEXT,
    color VARCHAR(7),  -- íƒœê·¸ ìƒ‰ìƒ (#FF5733)
    usage_count INTEGER DEFAULT 0
);

CREATE INDEX idx_tags_name ON tags(name);
```

#### 4.2.3 page_tags (ë‹¤ëŒ€ë‹¤ ê´€ê³„)
```sql
CREATE TABLE page_tags (
    page_id INTEGER REFERENCES pages(id) ON DELETE CASCADE,
    tag_id INTEGER REFERENCES tags(id) ON DELETE CASCADE,
    PRIMARY KEY (page_id, tag_id)
);

CREATE INDEX idx_page_tags_page ON page_tags(page_id);
CREATE INDEX idx_page_tags_tag ON page_tags(tag_id);
```

#### 4.2.4 edit_logs (í¸ì§‘ ë¡œê·¸)
```sql
CREATE TABLE edit_logs (
    id SERIAL PRIMARY KEY,
    page_slug VARCHAR(255) NOT NULL,
    action VARCHAR(20) NOT NULL,  -- create, update, delete
    author VARCHAR(100),
    commit_sha VARCHAR(40),  -- GitHub ì»¤ë°‹ í•´ì‹œ
    changes_summary TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT action_check CHECK (action IN ('create', 'update', 'delete'))
);

CREATE INDEX idx_edit_logs_page ON edit_logs(page_slug);
CREATE INDEX idx_edit_logs_created ON edit_logs(created_at DESC);
```

#### 4.2.5 images (ì´ë¯¸ì§€ ë©”íƒ€ë°ì´í„°)
```sql
CREATE TABLE images (
    id SERIAL PRIMARY KEY,
    filename VARCHAR(255) NOT NULL,
    original_name VARCHAR(255),
    url TEXT NOT NULL,  -- ì‹¤ì œ ì´ë¯¸ì§€ URL (GitHub ë˜ëŠ” R2)
    size_bytes INTEGER,
    mime_type VARCHAR(50),
    uploader VARCHAR(100),
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    alt_text TEXT,
    used_in_pages TEXT[]  -- ì´ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¬¸ì„œ slug ë°°ì—´
);

CREATE INDEX idx_images_filename ON images(filename);
```

#### 4.2.6 sync_queue (ë™ê¸°í™” ì‹¤íŒ¨ ë³µêµ¬ìš©)
```sql
CREATE TABLE sync_queue (
    id SERIAL PRIMARY KEY,
    slug VARCHAR(255) NOT NULL,
    github_sha VARCHAR(40) NOT NULL,
    status VARCHAR(20) DEFAULT 'pending',  -- pending, processing, completed, failed
    retry_count INTEGER DEFAULT 0,
    max_retries INTEGER DEFAULT 5,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    processed_at TIMESTAMP,
    error_message TEXT,
    CONSTRAINT status_check CHECK (status IN ('pending', 'processing', 'completed', 'failed'))
);

CREATE INDEX idx_sync_queue_status ON sync_queue(status);
CREATE INDEX idx_sync_queue_created ON sync_queue(created_at);
```

### 4.3 ê²€ìƒ‰ êµ¬í˜„ ì „ëµ

ê²€ìƒ‰ì€ ì´ ìœ„í‚¤ ì‹œìŠ¤í…œì˜ í•µì‹¬ ê¸°ëŠ¥ì…ë‹ˆë‹¤. TRPG ì„¤ì • ë¬¸ì„œëŠ” ë³µì¡í•˜ê²Œ ì–½í˜€ìˆê³ , íš¨ê³¼ì ì¸ ê²€ìƒ‰ì´ ì—†ìœ¼ë©´ ì›í•˜ëŠ” ì •ë³´ë¥¼ ì°¾ê¸° ì–´ë µìŠµë‹ˆë‹¤.

#### 4.3.1 í•œê¸€ ê²€ìƒ‰ì˜ ê³¼ì œ

**í˜•íƒœì†Œ ë³€í™” ë¬¸ì œ:**
```
ê²€ìƒ‰ì–´: "íŒ”ë¼ë”˜"
ë¬¸ì„œ ë‚´ìš©: "íŒ”ë¼ë”˜ì´", "íŒ”ë¼ë”˜ì˜", "íŒ”ë¼ë”˜ì„", "íŒ”ë¼ë”˜ì—ê²Œ"
â†’ ì •í™•í•œ ë§¤ì¹­ ì–´ë ¤ì›€ (ë‹¨ìˆœ LIKE ê²€ìƒ‰ìœ¼ë¡œëŠ” ì¼ë¶€ë§Œ ê²€ìƒ‰)
```

**í•´ê²° ë°©ë²•: PostgreSQL Trigram (pg_trgm)**
- Trigram: 3ê¸€ì ë‹¨ìœ„ë¡œ ë¬¸ìì—´ì„ ë¶„í•´í•˜ì—¬ ìœ ì‚¬ë„ ê³„ì‚°
- ì˜ˆ: "íŒ”ë¼ë”˜" â†’ "íŒ”ë¼", "ë¼ë”˜"
- í•œê¸€ í˜•íƒœì†Œ ë¶„ì„ ì—†ì´ë„ íš¨ê³¼ì ì¸ ìœ ì‚¬ë„ ê²€ìƒ‰ ê°€ëŠ¥

#### 4.3.2 ê²€ìƒ‰ ì¿¼ë¦¬ êµ¬í˜„

**ê¸°ë³¸ Trigram ê²€ìƒ‰:**
```sql
-- similarity() í•¨ìˆ˜: 0.0 ~ 1.0 ìœ ì‚¬ë„ ë°˜í™˜
SELECT
    slug,
    title,
    content,
    similarity(title, 'íŒ”ë¼ë”˜') AS title_sim,
    similarity(content, 'íŒ”ë¼ë”˜') AS content_sim
FROM pages
WHERE
    title % 'íŒ”ë¼ë”˜'      -- % ì—°ì‚°ì: ìœ ì‚¬ë„ ê¸°ë°˜ ë§¤ì¹­
    OR content % 'íŒ”ë¼ë”˜'
ORDER BY
    title_sim DESC,
    content_sim DESC
LIMIT 20;
```

**ê°€ì¤‘ì¹˜ ê¸°ë°˜ ê²€ìƒ‰ (ì œëª© > ë³¸ë¬¸):**
```sql
SELECT
    *,
    (similarity(title, :query) * 3.0 +        -- ì œëª© ê°€ì¤‘ì¹˜ 3ë°°
     similarity(content, :query) * 1.0) AS relevance_score
FROM pages
WHERE
    title % :query
    OR content % :query
ORDER BY relevance_score DESC
LIMIT 20;
```

**íƒœê·¸ í¬í•¨ ê²€ìƒ‰:**
```sql
SELECT
    p.*,
    (similarity(p.title, :query) * 3.0 +
     similarity(p.content, :query) * 1.0 +
     CASE WHEN EXISTS(
         SELECT 1 FROM page_tags pt
         JOIN tags t ON pt.tag_id = t.id
         WHERE pt.page_id = p.id
         AND t.name ILIKE '%' || :query || '%'
     ) THEN 2.0 ELSE 0.0 END) AS total_score
FROM pages p
WHERE
    p.title % :query
    OR p.content % :query
    OR EXISTS(
        SELECT 1 FROM page_tags pt
        JOIN tags t ON pt.tag_id = t.id
        WHERE pt.page_id = p.id AND t.name ILIKE '%' || :query || '%'
    )
ORDER BY total_score DESC
LIMIT 20;
```

**ê²€ìƒ‰ ê²°ê³¼ Snippet ìƒì„±:**
```sql
-- contentì—ì„œ ê²€ìƒ‰ì–´ ì£¼ë³€ í…ìŠ¤íŠ¸ ì¶”ì¶œ
SELECT
    slug,
    title,
    SUBSTRING(
        content
        FROM GREATEST(1, POSITION(:query IN content) - 50)
        FOR 150
    ) AS snippet
FROM pages
WHERE content % :query;
```

#### 4.3.3 ê²€ìƒ‰ ì„±ëŠ¥ ìµœì í™”

**ì¸ë±ìŠ¤ í™œìš©:**
```sql
-- GIN ì¸ë±ìŠ¤ë¡œ Trigram ê²€ìƒ‰ ì†ë„ í–¥ìƒ (10ë°° ì´ìƒ)
CREATE INDEX idx_pages_title_trgm ON pages USING gin (title gin_trgm_ops);
CREATE INDEX idx_pages_content_trgm ON pages USING gin (content gin_trgm_ops);

-- ìœ ì‚¬ë„ ì„ê³„ê°’ ì„¤ì • (ê¸°ë³¸ 0.3)
SET pg_trgm.similarity_threshold = 0.2;  -- ë” ë§ì€ ê²°ê³¼ ë°˜í™˜
```

**ì„±ëŠ¥ ì˜ˆìƒì¹˜:**
| ë¬¸ì„œ ìˆ˜ | ì¸ë±ìŠ¤ ì—†ìŒ | GIN ì¸ë±ìŠ¤ ì‚¬ìš© |
|---------|------------|----------------|
| 1,000ê°œ | ~500ms | ~50ms |
| 10,000ê°œ | ~5s | ~150ms |

#### 4.3.4 GitHub-PostgreSQL ë™ê¸°í™” ì „ëµ

**ì›ì¹™: GitHub = Source of Truth, PostgreSQL = Cache**

**ë¬¸ì„œ ìƒì„±/ìˆ˜ì • ì‹œ ë™ê¸°í™”:**
```python
# FastAPI ì—”ë“œí¬ì¸íŠ¸ ì˜ˆì‹œ
@app.put("/api/pages/{slug}")
async def update_page(slug: str, page_data: PageUpdate):
    # 1. GitHubì— ì»¤ë°‹ (Source of Truth)
    github_result = await github_client.update_file(
        repo=GITHUB_REPO,
        path=f"content/{slug}.md",
        content=page_data.content,
        message=f"Update {page_data.title}",
        sha=page_data.github_sha  # ë™ì‹œ ìˆ˜ì • ë°©ì§€
    )

    # 2. PostgreSQL ìºì‹œ ì—…ë°ì´íŠ¸
    await db.execute("""
        UPDATE pages
        SET
            content = :content,
            title = :title,
            updated_at = NOW(),
            github_sha = :new_sha,
            last_synced_at = NOW()
        WHERE slug = :slug
    """, {
        "content": page_data.content,
        "title": page_data.title,
        "new_sha": github_result.sha,
        "slug": slug
    })

    # 3. ë¡œê·¸ ê¸°ë¡
    await log_edit(slug, "update", page_data.author, github_result.sha)

    return {"success": True, "commit_sha": github_result.sha}
```

**ì™¸ë¶€ í¸ì§‘ ê°ì§€ (GitHub Actions):**
```yaml
# .github/workflows/sync-to-db.yml
name: Sync to PostgreSQL

on:
  push:
    paths:
      - 'content/**/*.md'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Trigger Backend Sync
        run: |
          # ë³€ê²½ëœ íŒŒì¼ ëª©ë¡ ì¶”ì¶œ
          FILES=$(git diff --name-only HEAD^ HEAD | grep '^content/.*\.md$')

          # ë°±ì—”ë“œ API í˜¸ì¶œí•˜ì—¬ ë™ê¸°í™”
          for file in $FILES; do
            curl -X POST "${{ secrets.BACKEND_URL }}/api/sync/github" \
              -H "Authorization: Bearer ${{ secrets.SYNC_TOKEN }}" \
              -H "Content-Type: application/json" \
              -d "{\"file_path\": \"$file\"}"
          done
```

**ë°±ì—”ë“œ ë™ê¸°í™” ì—”ë“œí¬ì¸íŠ¸:**
```python
@app.post("/api/sync/github")
async def sync_from_github(sync_request: GitHubSyncRequest):
    # GitHubì—ì„œ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
    file_content = await github_client.get_file_content(
        repo=GITHUB_REPO,
        path=sync_request.file_path
    )

    # Frontmatter íŒŒì‹±
    metadata, content = parse_frontmatter(file_content.decoded_content)

    # PostgreSQL ì—…ë°ì´íŠ¸ (UPSERT)
    await db.execute("""
        INSERT INTO pages (slug, title, content, github_sha, ...)
        VALUES (:slug, :title, :content, :sha, ...)
        ON CONFLICT (slug)
        DO UPDATE SET
            content = EXCLUDED.content,
            github_sha = EXCLUDED.github_sha,
            last_synced_at = NOW()
    """, {...})

    return {"synced": True}
```

#### 4.3.5 ê²€ìƒ‰ API ì‘ë‹µ ì˜ˆì‹œ

```json
{
  "query": "íŒ”ë¼ë”˜",
  "total": 5,
  "search_time_ms": 87,
  "results": [
    {
      "slug": "characters/player/elon",
      "title": "ì—˜ë¡  ì‹¤ë²„ìŠ¤íŠ¸ë¼ì´ë“œ",
      "snippet": "...í•˜ì´ì—˜í”„ íŒ”ë¼ë”˜ìœ¼ë¡œ, Oath of Devotionì„ ë”°ë¥´ëŠ”...",
      "relevance_score": 0.92,
      "matched_in": ["title", "content"],
      "tags": ["ì¢…ì¡±/ì—˜í”„", "í´ë˜ìŠ¤/íŒ”ë¼ë”˜"],
      "category": "characters/player",
      "updated_at": "2024-01-20T15:30:00Z"
    },
    {
      "slug": "lore/factions/silver-hand",
      "title": "ì€ë¹› ì† ê¸°ì‚¬ë‹¨",
      "snippet": "...íŒ”ë¼ë”˜ë“¤ë¡œ êµ¬ì„±ëœ ê¸°ì‚¬ë‹¨ìœ¼ë¡œ, ì •ì˜ì™€ ëª…ì˜ˆë¥¼...",
      "relevance_score": 0.75,
      "matched_in": ["content", "tags"],
      "tags": ["íŒŒë²Œ/ê¸°ì‚¬ë‹¨", "í´ë˜ìŠ¤/íŒ”ë¼ë”˜"],
      "category": "lore/factions",
      "updated_at": "2024-01-18T10:00:00Z"
    }
  ],
  "facets": {
    "categories": {
      "characters/player": 2,
      "lore/factions": 1,
      "items/weapons": 2
    },
    "tags": {
      "í´ë˜ìŠ¤/íŒ”ë¼ë”˜": 5,
      "ì¢…ì¡±/ì—˜í”„": 2
    }
  }
}
```

#### 4.3.6 ê³ ê¸‰ ê²€ìƒ‰ ê¸°ëŠ¥ (Post-MVP)

**ì •ê·œí‘œí˜„ì‹ ê²€ìƒ‰:**
```sql
SELECT * FROM pages
WHERE content ~ 'ë“œë˜ê³¤.*ê³ ëŒ€'  -- "ë“œë˜ê³¤"ê³¼ "ê³ ëŒ€" ì‚¬ì´ì— ì„ì˜ì˜ í…ìŠ¤íŠ¸
```

**ë³µí•© í•„í„° ê²€ìƒ‰:**
```python
# ì˜ˆ: "ì¢…ì¡±ì´ ì—˜í”„ì´ê³  í´ë˜ìŠ¤ê°€ íŒ”ë¼ë”˜ì¸ ìºë¦­í„° ê²€ìƒ‰"
query = {
    "text": "ì „ì„¤",
    "tags": ["ì¢…ì¡±/ì—˜í”„", "í´ë˜ìŠ¤/íŒ”ë¼ë”˜"],
    "category": "characters/player",
    "date_from": "2024-01-01"
}
```

**ìœ ì‚¬ ë¬¸ì„œ ì¶”ì²œ:**
```sql
-- íŠ¹ì • ë¬¸ì„œì™€ ìœ ì‚¬í•œ ë‹¤ë¥¸ ë¬¸ì„œ ì°¾ê¸° (íƒœê·¸ ê¸°ë°˜)
SELECT p2.*, COUNT(*) as common_tags
FROM pages p1
JOIN page_tags pt1 ON p1.id = pt1.page_id
JOIN page_tags pt2 ON pt1.tag_id = pt2.tag_id
JOIN pages p2 ON pt2.page_id = p2.id
WHERE p1.slug = :current_slug AND p2.slug != :current_slug
GROUP BY p2.id
ORDER BY common_tags DESC
LIMIT 5;
```

### 4.4 ë™ì‹œì„± ì²˜ë¦¬ ì „ëµ

ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ê°™ì€ ë¬¸ì„œë¥¼ í¸ì§‘í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì—ì„œì˜ ì¶©ëŒ ì²˜ë¦¬ ì „ëµì…ë‹ˆë‹¤. ë³µì¡í•œ ì‹¤ì‹œê°„ í˜‘ì—…(OT, CRDT) ëŒ€ì‹  **ë‚™ê´€ì  ë½(Optimistic Locking)** ê¸°ë°˜ì˜ ë‹¨ìˆœí•œ ì ‘ê·¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

#### 4.4.1 ê¸°ë³¸ ì›ì¹™

```
ë³µì¡ì„± ìµœì†Œí™”: ì‹¤ì‹œê°„ ë™ì‹œ í¸ì§‘ì´ ì•„ë‹Œ, "ë¨¼ì € ì €ì¥í•œ ì‚¬ëŒì´ ìŠ¹ë¦¬" ëª¨ë¸
í•µì‹¬: github_shaë¥¼ ë²„ì „ ì‹ë³„ìë¡œ ì‚¬ìš©
```

#### 4.4.2 ì¶©ëŒ ê°ì§€ íë¦„

```
1. ì‚¬ìš©ì A, Bê°€ ë™ì‹œì— "ì—˜ë¡ " ë¬¸ì„œ ì—´ê¸°
   â†’ ë‘˜ ë‹¤ github_sha: "abc123" ìˆ˜ì‹ 

2. Aê°€ ë¨¼ì € ì €ì¥
   â†’ GitHub ì»¤ë°‹ ì„±ê³µ, ìƒˆ sha: "def456"
   â†’ PostgreSQL ì—…ë°ì´íŠ¸

3. Bê°€ ì €ì¥ ì‹œë„ (ì—¬ì „íˆ sha: "abc123" ë³´ìœ )
   â†’ GitHub API 409 Conflict ë°˜í™˜
   â†’ ë°±ì—”ë“œì—ì„œ ì¶©ëŒ ê°ì§€
```

#### 4.4.3 ì¶©ëŒ ì‹œ ì‚¬ìš©ì ê²½í—˜ (UX)

**API ì‘ë‹µ:**
```json
{
  "error": {
    "code": "CONFLICT",
    "message": "ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì´ ë¬¸ì„œë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤",
    "details": {
      "your_sha": "abc123",
      "current_sha": "def456",
      "last_editor": "PlayerA",
      "last_edited_at": "2024-01-20T15:30:00Z"
    }
  },
  "current_content": "# ì—˜ë¡  ì‹¤ë²„ìŠ¤íŠ¸ë¼ì´ë“œ\n\n(í˜„ì¬ ì €ì¥ëœ ë‚´ìš©...)"
}
```

**í”„ë¡ íŠ¸ì—”ë“œ ì²˜ë¦¬:**
```javascript
// ì¶©ëŒ ë°œìƒ ì‹œ ëª¨ë‹¬ í‘œì‹œ
if (error.code === 'CONFLICT') {
  showConflictModal({
    yourContent: localContent,           // ì‚¬ìš©ìê°€ ì‘ì„±í•œ ë‚´ìš©
    serverContent: error.current_content, // ì„œë²„ì˜ ìµœì‹  ë‚´ìš©
    options: [
      { label: 'ë‚´ ë³€ê²½ì‚¬í•­ìœ¼ë¡œ ë®ì–´ì“°ê¸°', action: 'force_save' },
      { label: 'ì„œë²„ ë‚´ìš© ê°€ì ¸ì˜¤ê¸° (ë‚´ ì‘ì—… í¬ê¸°)', action: 'discard' },
      { label: 'ë‘ ë²„ì „ ë¹„êµí•˜ê¸°', action: 'show_diff' }
    ]
  });
}
```

**ê°„ë‹¨í•œ Diff í‘œì‹œ (ì„ íƒì‚¬í•­):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ ë¬¸ì„œ ì¶©ëŒ ë°œìƒ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PlayerAë‹˜ì´ 3ë¶„ ì „ì— ì´ ë¬¸ì„œë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤  â”‚
â”‚                                         â”‚
â”‚  [ë‚´ ë²„ì „]              [ì„œë²„ ë²„ì „]       â”‚
â”‚  ë ˆë²¨: 6               ë ˆë²¨: 5          â”‚
â”‚  HP: 45                HP: 42          â”‚
â”‚                                         â”‚
â”‚  [ë®ì–´ì“°ê¸°]  [í¬ê¸°í•˜ê³  ìƒˆë¡œê³ ì¹¨]  [ì·¨ì†Œ]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.4.4 ë°±ì—”ë“œ êµ¬í˜„

```python
@app.put("/api/pages/{slug}")
async def update_page(slug: str, page_data: PageUpdate):
    # 1. í˜„ì¬ DBì˜ sha í™•ì¸
    current = await db.fetch_one(
        "SELECT github_sha FROM pages WHERE slug = :slug",
        {"slug": slug}
    )

    # 2. í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚¸ shaì™€ ë¹„êµ (ë‚™ê´€ì  ë½)
    if current and current.github_sha != page_data.expected_sha:
        # ì¶©ëŒ ê°ì§€ - í˜„ì¬ ë‚´ìš©ê³¼ í•¨ê»˜ ë°˜í™˜
        current_page = await get_page(slug)
        raise HTTPException(
            status_code=409,
            detail={
                "code": "CONFLICT",
                "message": "ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì´ ë¬¸ì„œë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤",
                "details": {
                    "your_sha": page_data.expected_sha,
                    "current_sha": current.github_sha,
                    "last_editor": current_page.author,
                    "last_edited_at": current_page.updated_at.isoformat()
                },
                "current_content": current_page.content
            }
        )

    # 3. ì¶©ëŒ ì—†ìŒ - GitHub ì»¤ë°‹ ì§„í–‰
    try:
        github_result = await github_client.update_file(
            path=f"content/{slug}.md",
            content=page_data.content,
            sha=page_data.expected_sha  # GitHubë„ sha ì²´í¬í•¨
        )
    except GitHubConflictError:
        # GitHubì—ì„œë„ ì¶©ëŒ ê°ì§€ ê°€ëŠ¥ (ì´ì¤‘ ì•ˆì „ì¥ì¹˜)
        raise HTTPException(status_code=409, detail={"code": "CONFLICT", ...})

    # 4. PostgreSQL ì—…ë°ì´íŠ¸
    await update_db_cache(slug, page_data, github_result.sha)

    return {"success": True, "new_sha": github_result.sha}
```

**ê°•ì œ ë®ì–´ì“°ê¸° ì˜µì…˜:**
```python
@app.put("/api/pages/{slug}")
async def update_page(slug: str, page_data: PageUpdate):
    # force=Trueë©´ sha ì²´í¬ ê±´ë„ˆë›°ê¸°
    if not page_data.force:
        # ... ìœ„ì˜ ì¶©ëŒ ì²´í¬ ë¡œì§
        pass

    # force=Trueì¸ ê²½ìš°
    # í˜„ì¬ GitHubì˜ ìµœì‹  shaë¥¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©
    current_file = await github_client.get_file(f"content/{slug}.md")
    github_result = await github_client.update_file(
        path=f"content/{slug}.md",
        content=page_data.content,
        sha=current_file.sha  # ìµœì‹  shaë¡œ ë®ì–´ì“°ê¸°
    )
```

#### 4.4.5 í¸ì§‘ ì¤‘ ì•Œë¦¼ (ì„ íƒì‚¬í•­, Post-MVP)

ë³µì¡í•œ ì‹¤ì‹œê°„ ë™ê¸°í™” ì—†ì´ ê°„ë‹¨í•œ í´ë§ìœ¼ë¡œ êµ¬í˜„:

```javascript
// í¸ì§‘ í™”ë©´ì—ì„œ 30ì´ˆë§ˆë‹¤ ì²´í¬
const checkForUpdates = async () => {
  const response = await fetch(`/api/pages/${slug}/check?sha=${currentSha}`);
  if (response.data.has_update) {
    showWarning('ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì´ ë¬¸ì„œë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤. ì €ì¥ ì „ í™•ì¸í•˜ì„¸ìš”.');
  }
};

setInterval(checkForUpdates, 30000);
```

```python
@app.get("/api/pages/{slug}/check")
async def check_update(slug: str, sha: str):
    current = await db.fetch_one(
        "SELECT github_sha FROM pages WHERE slug = :slug",
        {"slug": slug}
    )
    return {"has_update": current.github_sha != sha}
```

### 4.5 ì—ëŸ¬ ì²˜ë¦¬ ë° ë³µêµ¬ ì „ëµ

GitHubê³¼ PostgreSQL ë‘ ì €ì¥ì†Œ ê°„ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•œ ì—ëŸ¬ ì²˜ë¦¬ ì „ëµì…ë‹ˆë‹¤. ë³µì¡í•œ ë¶„ì‚° íŠ¸ëœì­ì…˜ ëŒ€ì‹  **ìµœì¢… ì¼ê´€ì„±(Eventual Consistency)** ëª¨ë¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

#### 4.5.1 ê¸°ë³¸ ì›ì¹™

```
1. GitHub = Source of Truth (ì ˆëŒ€ì  ì›ë³¸)
2. PostgreSQL = Cache (ë³µêµ¬ ê°€ëŠ¥í•œ ìºì‹œ)
3. GitHub ì‹¤íŒ¨ â†’ ì „ì²´ ì‹¤íŒ¨ (ë¡¤ë°±)
4. PostgreSQL ì‹¤íŒ¨ â†’ ì¬ì‹œë„ + ë°±ê·¸ë¼ìš´ë“œ ë³µêµ¬
```

#### 4.5.2 ì—ëŸ¬ ì‹œë‚˜ë¦¬ì˜¤ë³„ ì²˜ë¦¬

**ì‹œë‚˜ë¦¬ì˜¤ 1: GitHub ì»¤ë°‹ ì‹¤íŒ¨**
```python
async def update_page(slug: str, page_data: PageUpdate):
    try:
        github_result = await github_client.update_file(...)
    except GitHubAPIError as e:
        # GitHub ì‹¤íŒ¨ = ì „ì²´ ì‹¤íŒ¨
        # PostgreSQLì— ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
        logger.error("github_commit_failed", slug=slug, error=str(e))
        raise HTTPException(
            status_code=502,
            detail={
                "code": "GITHUB_ERROR",
                "message": "ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",
                "retry_after": 5
            }
        )
```

**ì‹œë‚˜ë¦¬ì˜¤ 2: GitHub ì„±ê³µ, PostgreSQL ì‹¤íŒ¨**
```python
async def update_page(slug: str, page_data: PageUpdate):
    # 1. GitHub ì»¤ë°‹ ì„±ê³µ
    github_result = await github_client.update_file(...)

    # 2. PostgreSQL ì—…ë°ì´íŠ¸ ì‹œë„ (ì¬ì‹œë„ ë¡œì§ í¬í•¨)
    try:
        await update_db_with_retry(slug, page_data, github_result.sha)
    except DatabaseError as e:
        # DB ì‹¤íŒ¨í•´ë„ ì‚¬ìš©ìì—ê² ì„±ê³µ ë°˜í™˜
        # ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë³µêµ¬ ì˜ˆì•½
        logger.error("db_update_failed",
            slug=slug,
            github_sha=github_result.sha,
            error=str(e)
        )
        await schedule_sync_retry(slug, github_result.sha)

        # ì‚¬ìš©ìì—ê² ì„±ê³µìœ¼ë¡œ ì‘ë‹µ (GitHubì—ëŠ” ì €ì¥ë¨)
        return {
            "success": True,
            "new_sha": github_result.sha,
            "warning": "ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ê²€ìƒ‰ ë°˜ì˜ì— ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
        }

async def update_db_with_retry(slug, page_data, sha, max_retries=3):
    """ì¦‰ì‹œ ì¬ì‹œë„ (ì§€ìˆ˜ ë°±ì˜¤í”„)"""
    for attempt in range(max_retries):
        try:
            await db.execute(...)
            return
        except DatabaseError:
            if attempt < max_retries - 1:
                await asyncio.sleep(2 ** attempt)  # 1, 2, 4ì´ˆ
            else:
                raise
```

#### 4.5.3 ë¶ˆì¼ì¹˜ ê°ì§€ ë° ë³µêµ¬

**sync_queue í…Œì´ë¸”:**
```sql
CREATE TABLE sync_queue (
    id SERIAL PRIMARY KEY,
    slug VARCHAR(255) NOT NULL,
    github_sha VARCHAR(40) NOT NULL,
    status VARCHAR(20) DEFAULT 'pending',  -- pending, processing, completed, failed
    retry_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    processed_at TIMESTAMP,
    error_message TEXT
);

CREATE INDEX idx_sync_queue_status ON sync_queue(status);
```

**ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™” ì›Œì»¤:**
```python
# ë³„ë„ í”„ë¡œì„¸ìŠ¤ ë˜ëŠ” ìŠ¤ì¼€ì¤„ëŸ¬ì—ì„œ ì‹¤í–‰
async def sync_worker():
    """1ë¶„ë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” ë™ê¸°í™” ì›Œì»¤"""
    while True:
        # 1. ì‹¤íŒ¨í•œ ë™ê¸°í™” ì‘ì—… ê°€ì ¸ì˜¤ê¸°
        pending = await db.fetch_all("""
            SELECT * FROM sync_queue
            WHERE status IN ('pending', 'failed')
            AND retry_count < 5
            ORDER BY created_at ASC
            LIMIT 10
        """)

        for item in pending:
            try:
                # GitHubì—ì„œ ìµœì‹  ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
                content = await github_client.get_file_content(
                    f"content/{item.slug}.md"
                )

                # PostgreSQL ì—…ë°ì´íŠ¸
                await sync_page_to_db(item.slug, content, item.github_sha)

                # íì—ì„œ ì™„ë£Œ ì²˜ë¦¬
                await db.execute("""
                    UPDATE sync_queue
                    SET status = 'completed', processed_at = NOW()
                    WHERE id = :id
                """, {"id": item.id})

                logger.info("sync_recovered", slug=item.slug)

            except Exception as e:
                await db.execute("""
                    UPDATE sync_queue
                    SET status = 'failed',
                        retry_count = retry_count + 1,
                        error_message = :error
                    WHERE id = :id
                """, {"id": item.id, "error": str(e)})

        await asyncio.sleep(60)  # 1ë¶„ ëŒ€ê¸°
```

#### 4.5.4 ì¼ê´€ì„± ê²€ì¦ (ì„ íƒì‚¬í•­)

```python
@app.post("/api/admin/verify-consistency")
async def verify_consistency():
    """ê´€ë¦¬ììš©: GitHubì™€ PostgreSQL ì¼ê´€ì„± ê²€ì¦"""

    # GitHubì˜ ëª¨ë“  íŒŒì¼ ëª©ë¡
    github_files = await github_client.get_tree("content/")

    # PostgreSQLì˜ ëª¨ë“  ë¬¸ì„œ
    db_pages = await db.fetch_all("SELECT slug, github_sha FROM pages")
    db_map = {p.slug: p.github_sha for p in db_pages}

    inconsistencies = []

    for file in github_files:
        slug = file.path.replace("content/", "").replace(".md", "")

        if slug not in db_map:
            inconsistencies.append({
                "slug": slug,
                "issue": "missing_in_db",
                "github_sha": file.sha
            })
        elif db_map[slug] != file.sha:
            inconsistencies.append({
                "slug": slug,
                "issue": "sha_mismatch",
                "github_sha": file.sha,
                "db_sha": db_map[slug]
            })

    return {
        "total_github": len(github_files),
        "total_db": len(db_pages),
        "inconsistencies": inconsistencies
    }

@app.post("/api/admin/force-sync")
async def force_sync(slug: str = None):
    """ê°•ì œ ë™ê¸°í™” (ì „ì²´ ë˜ëŠ” íŠ¹ì • ë¬¸ì„œ)"""
    if slug:
        await sync_single_page(slug)
    else:
        await sync_all_pages()  # ì „ì²´ ì¬ë™ê¸°í™”
    return {"success": True}
```

#### 4.5.5 ì‚¬ìš©ì ì—ëŸ¬ ë©”ì‹œì§€ ê°€ì´ë“œ

| ì—ëŸ¬ ì½”ë“œ | ìƒí™© | ì‚¬ìš©ì ë©”ì‹œì§€ | ì•¡ì…˜ |
|----------|------|-------------|------|
| `GITHUB_ERROR` | GitHub API ì¥ì•  | "ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." | ì¬ì‹œë„ ë²„íŠ¼ |
| `CONFLICT` | ë™ì‹œ í¸ì§‘ ì¶©ëŒ | "ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì´ ë¬¸ì„œë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤." | ë®ì–´ì“°ê¸°/ìƒˆë¡œê³ ì¹¨ ì„ íƒ |
| `VALIDATION_ERROR` | ì…ë ¥ê°’ ì˜¤ë¥˜ | "ì œëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤." | ì…ë ¥ í•„ë“œ í•˜ì´ë¼ì´íŠ¸ |
| `DB_SYNC_DELAYED` | DB ë™ê¸°í™” ì§€ì—° | "ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ê²€ìƒ‰ ë°˜ì˜ì— ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤." | ì •ë³´ì„± ì•Œë¦¼ |
| `RATE_LIMITED` | ìš”ì²­ ê³¼ë‹¤ | "ìš”ì²­ì´ ë„ˆë¬´ ë§ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." | ëŒ€ê¸° í›„ ì¬ì‹œë„ |

#### 4.5.6 ì—ëŸ¬ íë¦„ ìš”ì•½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ë¬¸ì„œ ì €ì¥ ìš”ì²­                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  ì¶©ëŒ ì²´í¬       â”‚
                â”‚  (sha ë¹„êµ)      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                           â–¼
    [ì¶©ëŒ ì—†ìŒ]                    [ì¶©ëŒ ë°œìƒ]
           â”‚                           â”‚
           â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              409 CONFLICT
    â”‚ GitHub ì»¤ë°‹  â”‚              (ë‘ ë²„ì „ ë°˜í™˜)
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
     â–¼           â–¼
 [ì„±ê³µ]       [ì‹¤íŒ¨]
     â”‚           â”‚
     â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   502 GITHUB_ERROR
â”‚ DB ì €ì¥  â”‚   (ì¬ì‹œë„ ì•ˆë‚´)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
  â”Œâ”€â”€â”´â”€â”€â”
  â–¼     â–¼
[ì„±ê³µ] [ì‹¤íŒ¨]
  â”‚     â”‚
  â–¼     â–¼
200 OK  200 OK + warning
        + sync_queueì— ì¶”ê°€
        + ë°±ê·¸ë¼ìš´ë“œ ë³µêµ¬
```

---

## 5. API ì„¤ê³„

### 5.1 API ì—”ë“œí¬ì¸íŠ¸

#### 5.1.1 ë¬¸ì„œ ê´€ë¦¬

**GET /api/pages**
- ì„¤ëª…: ë¬¸ì„œ ëª©ë¡ ì¡°íšŒ
- ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°:
  - `category`: ì¹´í…Œê³ ë¦¬ í•„í„°
  - `tag`: íƒœê·¸ í•„í„° (ì½¤ë§ˆ êµ¬ë¶„ ë‹¤ì¤‘ ê°€ëŠ¥)
  - `status`: active/archived/draft
  - `sort`: created_at, updated_at, title, view_count
  - `order`: asc/desc
  - `page`, `limit`: í˜ì´ì§€ë„¤ì´ì…˜
- ì‘ë‹µ:
```json
{
  "total": 45,
  "pages": [
    {
      "slug": "characters/player/elon",
      "title": "ì—˜ë¡  ì‹¤ë²„ìŠ¤íŠ¸ë¼ì´ë“œ",
      "category": "characters/player",
      "tags": ["ì¢…ì¡±/ì—˜í”„", "í´ë˜ìŠ¤/íŒ”ë¼ë”˜"],
      "author": "PlayerName",
      "created_at": "2024-01-15T10:00:00Z",
      "updated_at": "2024-01-20T15:30:00Z",
      "summary": "ì •ì˜ë¥¼ ìˆ˜í˜¸í•˜ëŠ” ì—˜í”„ íŒ”ë¼ë”˜",
      "view_count": 42
    }
  ]
}
```

**GET /api/pages/{slug}**
- ì„¤ëª…: ë¬¸ì„œ ìƒì„¸ ì¡°íšŒ
- ì‘ë‹µ:
```json
{
  "slug": "characters/player/elon",
  "title": "ì—˜ë¡  ì‹¤ë²„ìŠ¤íŠ¸ë¼ì´ë“œ",
  "category": "characters/player",
  "tags": ["ì¢…ì¡±/ì—˜í”„", "í´ë˜ìŠ¤/íŒ”ë¼ë”˜"],
  "author": "PlayerName",
  "created_at": "2024-01-15T10:00:00Z",
  "updated_at": "2024-01-20T15:30:00Z",
  "content": "# ì—˜ë¡  ì‹¤ë²„ìŠ¤íŠ¸ë¼ì´ë“œ\n\n## ê¸°ë³¸ ì •ë³´...",
  "view_count": 42,
  "related_pages": [...]  // ê°™ì€ íƒœê·¸ë¥¼ ê°€ì§„ ë¬¸ì„œë“¤
}
```

**POST /api/pages**
- ì„¤ëª…: ìƒˆ ë¬¸ì„œ ìƒì„±
- ìš”ì²­ ë³¸ë¬¸:
```json
{
  "title": "ìƒˆ ìºë¦­í„°",
  "category": "characters/npc",
  "tags": ["ì¢…ì¡±/ì¸ê°„", "ì§ì—…/ìƒì¸"],
  "content": "# ìƒˆ ìºë¦­í„°\n\n...",
  "author": "DMName"
}
```
- ì‘ë‹µ: ìƒì„±ëœ ë¬¸ì„œ ì •ë³´ + GitHub ì»¤ë°‹ í•´ì‹œ

**PUT /api/pages/{slug}**
- ì„¤ëª…: ë¬¸ì„œ ìˆ˜ì •
- ìš”ì²­ ë³¸ë¬¸: POSTì™€ ë™ì¼
- ì‘ë‹µ: ì—…ë°ì´íŠ¸ëœ ë¬¸ì„œ ì •ë³´

**DELETE /api/pages/{slug}**
- ì„¤ëª…: ë¬¸ì„œ ì‚­ì œ (soft delete)
- ì‘ë‹µ: ì‚­ì œ ë¡œê·¸ ì •ë³´

#### 5.1.2 ê²€ìƒ‰

**GET /api/search**
- ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°:
  - `q`: ê²€ìƒ‰ì–´
  - `category`: ì¹´í…Œê³ ë¦¬ í•„í„°
  - `tags`: íƒœê·¸ í•„í„°
  - `page`, `limit`
- ì‘ë‹µ:
```json
{
  "total": 12,
  "results": [
    {
      "slug": "...",
      "title": "...",
      "snippet": "...ê²€ìƒ‰ì–´ê°€ í¬í•¨ëœ ë³¸ë¬¸ ì¼ë¶€...",
      "relevance": 0.85
    }
  ]
}
```

#### 5.1.3 íƒœê·¸

**GET /api/tags**
- ì„¤ëª…: ì „ì²´ íƒœê·¸ ëª©ë¡ (ì‚¬ìš© ë¹ˆë„ í¬í•¨)
- ì‘ë‹µ:
```json
{
  "tags": [
    {
      "name": "ì¢…ì¡±/ì—˜í”„",
      "display_name": "ì—˜í”„",
      "color": "#4CAF50",
      "usage_count": 15
    }
  ]
}
```

**GET /api/tags/{tag_name}/pages**
- ì„¤ëª…: íŠ¹ì • íƒœê·¸ì˜ ë¬¸ì„œ ëª©ë¡

#### 5.1.4 ì´ë¯¸ì§€ ì—…ë¡œë“œ

**POST /api/upload/image**
- ì„¤ëª…: ì´ë¯¸ì§€ ì—…ë¡œë“œ
- ìš”ì²­: multipart/form-data
- ì‘ë‹µ:
```json
{
  "url": "https://raw.githubusercontent.com/.../image.png",
  "filename": "image.png",
  "size": 245678
}
```

#### 5.1.5 í†µê³„

**GET /api/stats/recent**
- ì„¤ëª…: ìµœê·¼ ìˆ˜ì •ëœ ë¬¸ì„œ ëª©ë¡

**GET /api/stats/popular**
- ì„¤ëª…: ì¸ê¸° ë¬¸ì„œ (ì¡°íšŒìˆ˜ ê¸°ì¤€)

**GET /api/logs**
- ì„¤ëª…: í¸ì§‘ ë¡œê·¸ (ê´€ë¦¬ììš©)

### 5.2 ì—ëŸ¬ ì²˜ë¦¬

```json
{
  "error": {
    "code": "PAGE_NOT_FOUND",
    "message": "ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
    "details": {}
  }
}
```

ì£¼ìš” ì—ëŸ¬ ì½”ë“œ:
- `PAGE_NOT_FOUND`: 404
- `VALIDATION_ERROR`: 400
- `GITHUB_API_ERROR`: 502
- `INTERNAL_ERROR`: 500

---

## 6. ë°°í¬ ì „ëµ

### 6.1 ê°œë°œ í™˜ê²½

#### ë¡œì»¬ ê°œë°œ
```bash
# í”„ë¡ íŠ¸ì—”ë“œ
cd frontend
npm install
npm run dev  # localhost:5173

# ë°±ì—”ë“œ
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
uvicorn main:app --reload  # localhost:8000

# PostgreSQL (Docker)
docker run -d \
  --name xperion-wiki-db \
  -e POSTGRES_DB=xperion_wiki \
  -e POSTGRES_USER=admin \
  -e POSTGRES_PASSWORD=password \
  -p 5432:5432 \
  postgres:15
```

#### í™˜ê²½ ë³€ìˆ˜
```env
# backend/.env
DATABASE_URL=postgresql://admin:password@localhost:5432/xperion_wiki
GITHUB_TOKEN=ghp_xxxxxxxxxxxxx
GITHUB_REPO=username/xperion-wiki-content
GITHUB_BRANCH=main
SECRET_KEY=your-secret-key-here
CORS_ORIGINS=http://localhost:5173

# frontend/.env
VITE_API_URL=http://localhost:8000
```

### 6.2 í”„ë¡œë•ì…˜ ë°°í¬

#### GCP Compute Engine ë°°í¬ (ë°±ì—”ë“œ)

**ì™„ì „í•œ ë°°í¬ ê°€ì´ë“œëŠ” `/docs/DEPLOYMENT_GCP.md`ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.**

**ìš”ì•½:**
1. GCP Consoleì—ì„œ e2-micro VM ìƒì„± (us-central1 ë¦¬ì „)
2. Ubuntu 22.04 LTS ì„¤ì¹˜
3. SSH ì ‘ì† í›„ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰:
   ```bash
   cd ~/xperion-wiki/backend/scripts/deploy/gcp
   bash 01-setup-vm.sh          # VM ì´ˆê¸° ì„¤ì •
   bash 02-setup-database.sh    # PostgreSQL ì„¤ì •
   bash 03-deploy-app.sh        # ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
   bash 04-setup-nginx.sh       # Nginx + SSL ì„¤ì •
   ```

4. í™˜ê²½ ë³€ìˆ˜ (.env íŒŒì¼):
   - `DATABASE_URL` (ë¡œì»¬ PostgreSQL)
   - `GITHUB_TOKEN` (Fine-grained PAT)
   - `GITHUB_REPO`
   - `SECRET_KEY`
   - `CORS_ORIGINS` (Vercel í”„ë¡ íŠ¸ì—”ë“œ URL)

5. systemd ì„œë¹„ìŠ¤ë¡œ ìë™ ì‹œì‘

**ë¹„ìš©:** ì™„ì „ ë¬´ë£Œ (Always Free í‹°ì–´)

#### Vercel ë°°í¬ (í”„ë¡ íŠ¸ì—”ë“œ)
1. Vercel í”„ë¡œì íŠ¸ ì—°ê²° (GitHub)
2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •:
   - `VITE_API_URL` (GCP VM ë°±ì—”ë“œ URL, ì˜ˆ: https://api.xperion-wiki.com)
3. ë¹Œë“œ ì„¤ì •:
   - Build Command: `npm run build`
   - Output Directory: `dist`

### 6.3 GitHub Actions CI/CD

```yaml
# .github/workflows/backend-deploy.yml
name: Deploy Backend to GCP

on:
  push:
    branches: [main]
    paths:
      - 'backend/**'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - run: |
          cd backend
          pip install -r requirements.txt
          pytest

  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Deploy to GCP VM
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.GCP_VM_IP }}
          username: ${{ secrets.GCP_VM_USER }}
          key: ${{ secrets.GCP_SSH_KEY }}
          script: |
            cd ~/xperion-wiki/backend/scripts/deploy/gcp
            bash update-app.sh
```

---

## 7. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 7.1 ë¡œê¹… ì „ëµ

#### ë°±ì—”ë“œ ë¡œê¹… (structlog)
```python
import structlog

logger = structlog.get_logger()

# API ìš”ì²­ ë¡œê¹…
logger.info("page_viewed",
    slug=page_slug,
    user=user_id,
    duration_ms=125)

# ì—ëŸ¬ ë¡œê¹…
logger.error("github_api_error",
    endpoint="/contents/...",
    status_code=403,
    error=str(e))
```

#### ë¡œê·¸ ë ˆë²¨
- **INFO**: ì¼ë°˜ ìš”ì²­, ì„±ê³µì ì¸ ì‘ì—…
- **WARNING**: GitHub API rate limit ê·¼ì ‘, ëŠë¦° ì¿¼ë¦¬
- **ERROR**: API ì‹¤íŒ¨, DB ì—ëŸ¬
- **CRITICAL**: ì„œë¹„ìŠ¤ ì¥ì• 

### 7.2 ë©”íŠ¸ë¦­ ìˆ˜ì§‘

#### ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ (GCP VM)
- CPU ì‚¬ìš©ë¥ : `htop`, `top`
- ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : `free -h`
- ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰: `df -h`
- ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½: `iftop`
- ì„œë¹„ìŠ¤ ìƒíƒœ: `systemctl status xperion-wiki`

#### ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ (DB ì €ì¥)
```sql
CREATE TABLE metrics (
    id SERIAL PRIMARY KEY,
    metric_name VARCHAR(50),
    value FLOAT,
    labels JSONB,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ì˜ˆì‹œ: API ì‘ë‹µ ì‹œê°„
INSERT INTO metrics (metric_name, value, labels)
VALUES ('api_response_time', 125.5, '{"endpoint": "/api/pages", "method": "GET"}');
```

### 7.3 ì—ëŸ¬ íŠ¸ë˜í‚¹ (Sentry)

#### í”„ë¡ íŠ¸ì—”ë“œ
```javascript
import * as Sentry from "@sentry/react";

Sentry.init({
  dsn: "https://...@sentry.io/...",
  environment: import.meta.env.MODE,
  tracesSampleRate: 1.0,
});
```

#### ë°±ì—”ë“œ
```python
import sentry_sdk
from sentry_sdk.integrations.fastapi import FastApiIntegration

sentry_sdk.init(
    dsn="https://...@sentry.io/...",
    integrations=[FastApiIntegration()],
    traces_sample_rate=1.0,
)
```

### 7.4 ì•Œë¦¼ ì„¤ì •

#### ì‹œìŠ¤í…œ ì•Œë¦¼ (ì„ íƒì‚¬í•­)
- ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ 80% ì´ˆê³¼ ì‹œ ì´ë©”ì¼ ì•Œë¦¼ (cron + script)
- ì„œë¹„ìŠ¤ ë‹¤ìš´ ì‹œ ì¬ì‹œì‘ (systemd Restart=always)
- ë©”ëª¨ë¦¬ ë¶€ì¡± ì‹œ ìë™ ì¬ì‹œì‘ (systemd MemoryMax)

#### Sentry ì•Œë¦¼
- ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ì•Œë¦¼
- ì—ëŸ¬ ë¹ˆë„ ê¸‰ì¦ ì‹œ ì•Œë¦¼

#### GitHub Actions ì•Œë¦¼
- ë°°í¬ ì‹¤íŒ¨ ì‹œ ì´ë©”ì¼ ì•Œë¦¼
- í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œ ì•Œë¦¼

---

## 8. ê°œë°œ ë¡œë“œë§µ

### Phase 1: MVP ê°œë°œ âœ… (ì™„ë£Œ - 2026-01-08)

#### Week 1-2: ë°±ì—”ë“œ ê¸°ë°˜ êµ¬ì¶• âœ…
- [x] FastAPI í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
- [x] PostgreSQL ìŠ¤í‚¤ë§ˆ ì„¤ê³„ ë° ë§ˆì´ê·¸ë ˆì´ì…˜
- [x] GitHub API ì—°ë™ (íŒŒì¼ ì½ê¸°/ì“°ê¸°)
- [x] ê¸°ë³¸ CRUD API êµ¬í˜„
- [ ] GCP Compute Engine ë°°í¬ í™˜ê²½ êµ¬ì¶• (ì§„í–‰ ì¤‘)

#### Week 3-4: í”„ë¡ íŠ¸ì—”ë“œ ê¸°ë³¸ êµ¬ì¡° âœ…
- [x] React + Vite í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
- [x] ë¼ìš°íŒ… ì„¤ì • (ë¬¸ì„œ ëª©ë¡/ìƒì„¸)
- [x] ë§ˆí¬ë‹¤ìš´ ë Œë”ëŸ¬ êµ¬í˜„
- [x] ê¸°ë³¸ UI/UX (TailwindCSS)
- [ ] Vercel ë°°í¬ (ì§„í–‰ ì˜ˆì •)

#### Week 5-6: í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„ âœ…
- [x] ë§ˆí¬ë‹¤ìš´ ì—ë””í„° (ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°)
- [x] íƒœê·¸ ì‹œìŠ¤í…œ
- [x] ì „ë¬¸ ê²€ìƒ‰ (PostgreSQL Trigram)
- [x] ì´ë¯¸ì§€ ì—…ë¡œë“œ
- [x] í†µí•© í…ŒìŠ¤íŠ¸

**ì§„í–‰ë¥ **: 85% (ë°°í¬ ì œì™¸ ì‹œ ì™„ë£Œ)
**ìƒì„¸ ì§„í–‰ìƒí™©**: [PROGRESS.md](./PROGRESS.md) ì°¸ì¡°

### Phase 2: ê³ ë„í™” (4ì£¼)

#### Week 7-8: ì‚¬ìš©ì„± ê°œì„ 
- [ ] ìœ„í‚¤ ë§í¬ ì‹œìŠ¤í…œ (`[[ë¬¸ì„œëª…]]`)
- [ ] ì—­ë§í¬ í‘œì‹œ
- [ ] ë¬¸ì„œ ë²„ì „ íˆìŠ¤í† ë¦¬
- [ ] ìë™ ì €ì¥ ê¸°ëŠ¥

#### Week 9-10: ëª¨ë‹ˆí„°ë§ ë° ìµœì í™”
- [ ] ë¡œê¹… ì‹œìŠ¤í…œ ê°•í™”
- [ ] Sentry ì—ëŸ¬ íŠ¸ë˜í‚¹
- [ ] ì„±ëŠ¥ ìµœì í™” (ì¿¼ë¦¬, ì¸ë±ìŠ¤)
- [ ] ìºì‹± ì „ëµ (Redis ì„ íƒì  ë„ì…)

### Phase 3: í™•ì¥ ê¸°ëŠ¥ (ì§„í–‰í˜•)
- [ ] í†µê³„ ëŒ€ì‹œë³´ë“œ
- [ ] ë¬¸ì„œ í…œí”Œë¦¿ ì‹œìŠ¤í…œ
- [ ] ê³ ê¸‰ ê²€ìƒ‰ (ì •ê·œí‘œí˜„ì‹, í•„í„°)
- [ ] ëª¨ë°”ì¼ ì•± (ì„ íƒì‚¬í•­)
- [ ] API ë¬¸ì„œ ìë™ ìƒì„± (OpenAPI)

---

## 9. ì°¸ê³  ì‚¬í•­

### 9.1 ë¹„ìš© ì˜ˆìƒ

- **GCP Compute Engine**: **ë¬´ë£Œ** (e2-micro, Always Free í‹°ì–´)
  - 720ì‹œê°„/ì›” (24/7 ê°€ëŠ¥)
  - 30GB í‘œì¤€ ë””ìŠ¤í¬
  - 1GB ì•„ì›ƒë°”ìš´ë“œ íŠ¸ë˜í”½/ì›”
  - âš ï¸ íŠ¸ë˜í”½ ì´ˆê³¼ ì‹œ: $0.12/GB (10GB ì´ˆê³¼í•´ë„ $1.2)
- **PostgreSQL**: **ë¬´ë£Œ** (VM ìì²´ ì„¤ì¹˜)
- **Nginx + SSL**: **ë¬´ë£Œ** (ì˜¤í”ˆì†ŒìŠ¤ + Let's Encrypt)
- **Vercel**: **ë¬´ë£Œ** (Hobby í”Œëœ, 100GB ëŒ€ì—­í­)
- **GitHub**: **ë¬´ë£Œ** (Private repo, 1GB ìŠ¤í† ë¦¬ì§€)
- **Cloudflare R2**: **ë¬´ë£Œ** (10GB ìŠ¤í† ë¦¬ì§€)
- **Sentry**: **ë¬´ë£Œ** (5,000 ì´ë²¤íŠ¸/ì›”)

**ì´ ì˜ˆìƒ ë¹„ìš©: $0/ì›”** (ì™„ì „ ë¬´ë£Œ!)
**ìµœëŒ€ ë¹„ìš© (íŠ¸ë˜í”½ ì´ˆê³¼ ì‹œ): ~$1-2/ì›”**

### 9.2 ì„±ëŠ¥ ëª©í‘œ

- **í˜ì´ì§€ ë¡œë”©**: < 1ì´ˆ (í”„ë¡ íŠ¸ì—”ë“œ)
- **API ì‘ë‹µ**: < 200ms (í‰ê· )
- **ê²€ìƒ‰ ì‘ë‹µ**: < 500ms
- **ë¬¸ì„œ ì €ì¥**: < 3ì´ˆ (GitHub ì»¤ë°‹ í¬í•¨)

### 9.3 í™•ì¥ì„± ê³ ë ¤ì‚¬í•­

- **ë¬¸ì„œ ìˆ˜**: ìµœëŒ€ 10,000ê°œ (PostgreSQL FTS ì¶©ë¶„)
- **ë™ì‹œ ì‚¬ìš©ì**: 50ëª… (Railway ë¬´ë£Œ í‹°ì–´ ì¶©ë¶„)
- **ì´ë¯¸ì§€ ìŠ¤í† ë¦¬ì§€**: 10GB (Cloudflare R2 ë¬´ë£Œ í•œë„)

---

## 10. ë‹¤ìŒ ë‹¨ê³„

1. **GitHub Repository ìƒì„±**
   - `xperion-wiki` (ë©”ì¸ í”„ë¡œì íŠ¸)
   - `xperion-wiki-content` (Private, Markdown íŒŒì¼)

2. **ê°œë°œ í™˜ê²½ ì„¸íŒ…**
   - ë¡œì»¬ PostgreSQL ì„¤ì¹˜
   - GitHub Token ë°œê¸‰ (Fine-grained PAT)

3. **GCP VM ìƒì„± ë° ë°°í¬**
   - **ìƒì„¸ ê°€ì´ë“œ**: [`/docs/DEPLOYMENT_GCP.md`](/docs/DEPLOYMENT_GCP.md)
   - GCP Consoleì—ì„œ e2-micro VM ìƒì„±
   - ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

4. **í”„ë¡œí† íƒ€ì… ê°œë°œ ì‹œì‘**
   - ë°±ì—”ë“œ: ê°„ë‹¨í•œ í˜ì´ì§€ CRUD
   - í”„ë¡ íŠ¸ì—”ë“œ: ë¬¸ì„œ ì¡°íšŒ í™”ë©´

---

## ê´€ë ¨ ë¬¸ì„œ

- **[GCP ë°°í¬ ê°€ì´ë“œ](/docs/DEPLOYMENT_GCP.md)**: ì™„ì „í•œ ë°°í¬ ì ˆì°¨ ë° íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
- **[ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ README](/backend/scripts/deploy/gcp/README.md)**: ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©ë²•

---

**ë¬¸ì„œ ì‘ì„±ì¼**: 2026-01-04
**ìµœì¢… ìˆ˜ì •ì¼**: 2026-01-07
**ì‘ì„±ì**: AI Assistant + í”„ë¡œì íŠ¸ ì˜¤ë„ˆ
